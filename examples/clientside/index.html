<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="UTF-8">
<link type="text/css" rel="stylesheet" href="reset.css" />
<link type="text/css" rel="stylesheet" href="style.css" />
<link type="text/css" rel="stylesheet" href="prettify/prettify.css" />
<title>umecob.js</title>
<script type="text/javascript" src="prettify/prettify.js"></script>
<script type="text/javascript" src="../../jsdeferred.js"></script>
<script type="text/javascript" src="../../jshint.js"></script>
<script type="text/javascript" src="../../umecob.js"></script>
<script type="text/javascript" src="jquery-1.4.2.min.js"></script>
<script type="text/javascript">
umecob.codes = {}
umecob.start( function(u) {
  u.code = umecob.codes[u.tpl_id] || null
}).end( function(u) {
  umecob.codes[u.tpl_id] = u.code
})

function load(lang) {
  var rand = String(Math.random()).replace(/\./, '');
  localStorage.lang = lang;
  load.lang = lang;

  var deferred = Deferred.parallel({
    lang : umecob.binding("xhr").getData.async(lang + ".lang"),
    v    : umecob.binding("xhr").getData.async("sample.data"),
    esc  : umecob.binding("xhr").getData.async("htmlspecialchars.js")
  }).
  next(function(vals) {
    vals.i   = 0;
    return vals;
  });

  umecob.use("xhr")({tpl_id: "template.html", data: deferred, attach: function(data) {data.esc = eval(data.esc)} })
  .next(function(result) {
    result += '<div stle="display:none;" id="domFinishedTeller'+ rand+'"></div>';
    $("body").html(result);
    var colorize = setInterval(function(){
      console.log("setInterval");
      if ( $("#domFinishedTeller"+rand).size() ) {
        prettyPrint();
        console.log("clearInterval");
        clearInterval(colorize);
      }
    }, 30);
  })
  .error(function(e) {
    console.log(e)
  });

}

load(localStorage.lang || "en")
</script>
</head>
<body>
</body>
</html>
